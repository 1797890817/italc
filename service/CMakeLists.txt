FILE(GLOB service_INCLUDES ${CMAKE_CURRENT_SOURCE_DIR}/src/*.h)
FILE(GLOB service_SOURCES ${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp)
QT5_WRAP_CPP(service_MOC_out ${service_INCLUDES})

IF(ITALC_BUILD_LINUX)

	ADD_SUBDIRECTORY(helpers)

ENDIF(ITALC_BUILD_LINUX)

IF(ITALC_BUILD_WIN32)

	ADD_SUBDIRECTORY(win32)
	INCLUDE_DIRECTORIES(${ultravnc_DIR}/winvnc/winvnc)

	SET(WINRC "${CMAKE_CURRENT_BINARY_DIR}/italc-service-rc.obj")
	ADD_CUSTOM_COMMAND(OUTPUT ${WINRC}
						COMMAND ${WINDRES}
							-I${CMAKE_CURRENT_SOURCE_DIR}
							-o${WINRC}
							-i${CMAKE_CURRENT_BINARY_DIR}/italc-service.rc
						DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/italc-service.rc)

ENDIF(ITALC_BUILD_WIN32)

INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${CMAKE_CURRENT_SOURCE_DIR}/src)

ADD_EXECUTABLE(italc-service ${service_SOURCES} ${service_INCLUDES} ${service_MOC_out} ${libvncserver_DIR}/common/d3des.c ${WINRC})
TARGET_LINK_LIBRARIES(italc-service italc-core)

INSTALL(TARGETS italc-service RUNTIME DESTINATION bin)

IF(ITALC_BUILD_WIN32)
	SET_TARGET_PROPERTIES(italc-service PROPERTIES LINK_FLAGS -mwindows)
ENDIF(ITALC_BUILD_WIN32)

TARGET_LINK_LIBRARIES(italc-service
        Qt5::Gui
        Qt5::Network
        Qt5::Widgets
        Qt5::Xml
	)
